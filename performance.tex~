\documentclass[thesis.tex]{subfiles}

\begin{document}
\chapter{Performance testing}
\section{Test data}
Because the experiements are meant to reflect usage in an everyday situation the tests are run on real genetic data fetched from the vg github repo\cite{vg}, and from the test-set provided forthe previously mentioned tool made by Noval et al. The sequences correspond to allelles of the MHC region\ref{sec:mhc} and chromosome 6 in the human genome. All the data used can be found in the github of the ``Fuzzy context-based search'' tool (Appendix \ref{sec:tool}).\\
\par\noindent
In order to do an alignment there needs to exists reads aswell as the reference graph itself. A read for a graph $G$ is generated by the following procedure:
\begin{enumerate}
  \item Choose a read length $l$, an SNP-probability $p_s$ a deletion probability $p_d$ and an insertion probability $p_i$
  \item Choose a random vertice $v_x \in G$ where every path to the end vertice $t_G$ has a length $\geq l$
  \item For $r$ steps:
  \begin{enumerate}
    \item Append $b(v_x)$ to the read $r$
    \item Set the new $v_x$ as a random neighbour of the old $v_x$
  \end{enumerate}
  \item Add noise to $r$ according to $p_s$, $p_i$ and $p_d$.
\end{enumerate}
Because this thesis is concerned with the mathematical properties of the model the noise in the reads does not necessarily depict the true nature of either genetic variation (Section \ref{sec:genetic_variation}) or read errors (Section \ref{sec:sequencing}). \textcolor{red}{why is this ok}. In order to provide reproducability the randomness in the reads are generated from a seed.
\section{Validation}
When an alignment is produced for a read it is classified either as optimal or not optimal. Intuitively this can be determined by whether the generated read aligns back to the path it was generated from. However, when noise is introduced an interesting phenomenon can occur: The modified read can be more similar to another path than its origin. This can also occur whenever there exists actual equal paths in the graph, typically in the case of repeats. In order to stick with mathemathical properties, optimality holds no relation to the origin of a read but is purely defined as the path which produces the highest possible alignment score. As PO-MSA is an exhaustive search we define optimally aligned as alignments which produce the same alignment score as the highest score found by PO-MSA. Consequently, as only the scores are compared, even when the approaches produce different alignments than PO-MSA these can be classified as optimal. This falls within the problem definition (Definition \ref{def:bounded_alignment_problem}).
\section{Building the index}
\begin{figure}
    \begin{tikzpicture}
      \begin{axis}[scale only axis,height=\textwidth,width=\textwidth,xmin=0,ymin=0,xmax=152451,ymax=122654330941,scaled ticks=false, xlabel={Number of vertices}, ylabel={Nanoseconds (ns)}]
        \addplot[color=black,mark=*] coordinates {
          (701,597127494)
          (3416,2050636347)
          (20931,13858701254)
          (37801,25401423058)
          (100351,77928851412)
          (152451,122654330941)
        };
      \end{axis}
    \end{tikzpicture}
    \caption{Runtime for the build index procedure}
\end{figure}
\begin{figure}
  \begin{subfigure}[t]{0.4\textwidth}
    \begin{tikzpicture}[trim axis left]
      \begin{axis}[scale only axis,height=\textwidth,width=\textwidth,xmin=0,ymin=0,xmax=152451,ymax=122654330941,scaled ticks=false]
        \addplot coordinates {
          (701,9404263)
          (3416,51489024)
          (20931,623903806)
          (37801,1031820116)
          (100351,5487825644)
          (152451,11328920839)
        };
      \end{axis}
    \end{tikzpicture}
    \subcaption{Time used building the graph}
  \end{subfigure}
  \hfill
  \begin{subfigure}[t]{0.4\textwidth}
    \begin{tikzpicture}[trim axis left]
      \begin{axis}[scale only axis,height=\textwidth,width=\textwidth,xmin=0,ymin=0,xmax=152451,ymax=122654330941,scaled ticks=false]
        \addplot[color=green,mark=*] coordinates {
          (701,65184733)
          (3416,138556745)
          (20931,269431681)
          (37801,2788165703)
          (100351,6905517064)
          (152451,10007919085)
        };
      \end{axis}
    \end{tikzpicture}
    \subcaption{Time used building the index}
  \end{subfigure}
  \begin{subfigure}[b]{0.4\textwidth}
    \begin{tikzpicture}[trim axis left]
      \begin{axis}[scale only axis,height=\textwidth,width=\textwidth,xmin=0,ymin=0,xmax=152451,ymax=122654330941,scaled ticks=false]
        \addplot[color=red,mark=*] coordinates {
          (701,522174790)
          (3416,1860265733)
          (20931,1296505592)
          (37801,21581107294)
          (100351,65535179527)
          (152451,101317180800)
        };
      \end{axis}
    \end{tikzpicture}
    \subcaption{Time used writing the index\vspace{\baselineskip}}
  \end{subfigure}
  \hfill
  \begin{subfigure}[b]{0.4\textwidth}
  \begin{tikzpicture}[trim axis left]
    \begin{axis}[scale only axis,height=\textwidth,width=\textwidth,xmin=0,ymin=0,xmax=152451,ymax=122654330941,scaled ticks=false]
      \addplot[name path=axis] coordinates {
        (0, 0)
        (152451, 0)
      };
      \addplot[color=blue,name path=graph] coordinates {
        (701,9404263)
        (3416,51489024)
        (20931,623903806)
        (37801,1031820116)
        (100351,5487825644)
        (152451,11328920839)
      };
      \addplot[color=green, name path=index] coordinates {
        (701,9404263 + 65184733)
        (3416,51489024 + 138556745)
        (20931,6239033806 + 269431681)
        (37801,1031820116 + 2788165703)
        (100351,5487825644 + 6905517064)
        (152451,11328920839 + 10007919085)
      };
      \addplot[color=black, name path=total,mark=*] coordinates {
        (701,597127494)
        (3416,2050636347)
        (20931,13858701254)
        (37801,25401423058)
        (100351,77928851412)
        (152451,122654330941)
      };
      \addplot[red!30] fill between[of=index and total];
      \addplot[green!30] fill between[of=graph and index];
      \addplot[blue!30] fill between[of=graph and axis];
    \end{axis}
  \end{tikzpicture}
  \subcaption{Total run time as a combination of the individual steps}
  \end{subfigure}
  \caption{Time (ns) used by the indexation process as a function of the number of vertices}
\end{figure}
\subsection{Alignment}
\begin{figure}
  \begin{tikzpicture}
    \begin{axis}[scale only axis,height=\textwidth,width=\textwidth,xmin=0,ymin=0,xmax=152451,ymax=5000000000,scaled ticks=false, legend pos=north west]
      \addplot[color=blue,mark=*] coordinates {
        (701, 28197210)
        (3416, 32719710)
        (20931, 33308335)
        (37801,  30339892)
        (100351, 41266794)
        (152451, 0)
      };
      \addplot[color=black,mark=*] coordinates {
        (701, 50715055)
        (3416, 106071102)
        (20931, 331411927)
        (37801,  817322537)
        (100351, 2521874503)
        (152451, 0)
      };
      \addlegendentry{Fuzzy}
      \addlegendentry{PO-MSA}
    \end{axis}
  \end{tikzpicture}
  \caption{Runtime of the alignment process as a function of the number of vertices}
  \label{fig:runtime_po-msa_fuzzy_0_0}
\end{figure}
\section{Alignment}
\section{Comparison with other tools}
\end{document}