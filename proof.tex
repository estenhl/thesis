\documentclass[thesis.tex]{subfiles}

\begin{document}
\chapter{Proving optimality}
\label{sec:proof}
Because the description of the approach is rather comprehensive, we chose to include a more brief proof that the approach is correct. Because the second step of the algorithm is exhaustive we only need to prove the first step: Every vertex part of an optimal alignment is passed on from the suffix tree search.\\
\par\noindent
We have a graph $G$ and a string $s$ such that there exists an optimal alignment $A$ with a score $\$_A$. We have an error-margin $\lambda$ such that the maximal achievable alignment score $max(s)$ is smaller than $\$_A + \lambda$. Because we are using consistent scoring schemas we know $max(s) = align(s, s)$. We also know $max(s+c)=max(s)+mappingScore(c, c)$ for any $c \in \Sigma$. Thus we can view $max(s)$ as a discrete function of the length of $s$, where the increase between any two indices are maximal for $s$.\\
\par\noindent
We now assume the opposite case of what we are trying to prove:
\begin{assumption}
\label{assumption}
There exists a vertex $v$ which is part of an optimal alignment with a score $\varphi_A>max(s)-\lambda$ which is pruned away from in the suffix tree search.
\end{assumption}
\noindent
Because $v$ is pruned away it is not a part of any contexts which has a context score higher than $T_c=max(s')-\lambda$ for any substring $s' \in s$. If we pick out the highest scoring context $c$ this has a context score $T_c<max(s')-\lambda$. There are two cases to cover: Either $s'=s$ or $|s'|<|s|$. In the first case we can let the context score $T_c$ also denote the alignment score $\varphi_A$. We insert $s'=s$ into the calculation and find $\varphi_A<max(s)-\lambda$ which contradicts the assumption. In the second case of $|s'|<|s|$ there exists a part of the string $s$ which is not covered by the substring $s'$ aligned against the context. We call this part $\bar{s}$. We let $x$ denote the value which is lost when aligning $c$ against $s'$ such that $T_c=max(s')-\lambda-x,x>0$. In order for the alignment of the full string $s'+\bar{s}$ to achieve a score $\varphi_A>max(s)-\lambda$, $\bar{s}$ has to be aligned against contexts such that the sum of their scores $T_c=max(\bar{s})+x,x>0$. From the previous definition of $max$ we know that no alignment of any of the substrings $\bar{s} \in s$ can achieve a score higher than $max(\bar{s})$, which means this is impossible. Thus the max score for any alignment containing this context is $\varphi_A=max(s)-\lambda-x,x>0$ which also contradicts the assumption. Because both the exahustive cases lead to contradictions, the assumption is invalid.
\end{document}